#azure_keyvault.py

import os
import json
import logging
from azure.identity import DefaultAzureCredential
from azure.keyvault.secrets import SecretClient

class AzureKeyVaultManager:
    def __init__(self, vault_url):
        """
        Initialize Azure Key Vault client
        
        :param vault_url: URL of the Azure Key Vault
        """
        try:
            # Use DefaultAzureCredential for authentication
            credential = DefaultAzureCredential()
            
            # Create a SecretClient
            self.secret_client = SecretClient(vault_url=vault_url, credential=credential)
            
            logging.info(f"Connected to Azure Key Vault: {vault_url}")
        except Exception as e:
            logging.error(f"Failed to connect to Azure Key Vault: {e}")
            raise

    def get_secret(self, secret_name):
        """
        Retrieve a secret from Azure Key Vault
        
        :param secret_name: Name of the secret
        :return: Secret value
        """
        try:
            # Retrieve the secret
            secret = self.secret_client.get_secret(secret_name)
            return secret.value
        except Exception as e:
            logging.error(f"Error retrieving secret {secret_name}: {e}")
            raise

def load_config_with_keyvault(config_path):
    """
    Load configuration file and replace Azure Key Vault placeholders
    
    :param config_path: Path to the configuration file
    :return: Processed configuration dictionary
    """
    try:
        # Read the configuration file
        with open(config_path, 'r') as f:
            config = json.load(f)
        
        # Check if Azure Key Vault configuration exists
        if 'azure_keyvault' not in config:
            return config
        
        # Initialize Azure Key Vault client
        keyvault_url = config['azure_keyvault'].get('vault_url')
        if not keyvault_url:
            logging.warning("Azure Key Vault URL not provided")
            return config
        
        keyvault_manager = AzureKeyVaultManager(keyvault_url)
        
        # Recursively process the configuration
        def process_config(obj):
            if isinstance(obj, dict):
                for key, value in obj.items():
                    if isinstance(value, str) and value.startswith('@azurekeyvault(') and value.endswith(')'):
                        # Extract secret name
                        secret_name = value[len('@azurekeyvault('):-1]
                        try:
                            # Retrieve secret from Azure Key Vault
                            obj[key] = keyvault_manager.get_secret(secret_name)
                        except Exception as e:
                            logging.error(f"Failed to retrieve secret {secret_name}: {e}")
                            # Optionally, you can choose to keep the original value or raise an exception
                    elif isinstance(value, (dict, list)):
                        process_config(value)
            elif isinstance(obj, list):
                for i, item in enumerate(obj):
                    if isinstance(item, (dict, list)):
                        process_config(item)
        
        # Process the entire configuration
        process_config(config)
        
        return config
    
    except Exception as e:
        logging.error(f"Error loading configuration with Key Vault: {e}")
        raise
------

helper.py

import json
import logging
from azure_keyvault import load_config_with_keyvault

def load_config(config_path):
    """
    Load configuration file with Azure Key Vault support
    
    :param config_path: Path to the configuration file
    :return: Processed configuration dictionary
    """
    try:
        # Use the new Key Vault-aware configuration loader
        config = load_config_with_keyvault(config_path)
        return config
    except Exception as e:
        logging.error(f"Failed to load configuration: {e}")
        raise
