class SimpleCSVConsolidator:
    def build_prompt(self, rows: List[Dict]) -> str:
        instructions = """
1. Keep identical values only once (except for special columns mentioned below).
2. Merge differing values intelligently.
3. Merge line items so each line appears once.
4. Do not lose any information.
5. Do not duplicate information.
6. Use EXACT SAME column names as input.
7. Output must be VALID JSON ONLY.
8. Output must represent ONE consolidated row.
9. Consider numeric sequences before merging values; ensure numbers are evaluated correctly.
10. Use ";" to separate merged values where applicable, instead of "/" or "-".
11. If a value includes both a date and a timestamp (e.g., "11/25/2025;11/25/2025 3:03:47 PM"),
    evaluate the header/context of the column to determine the appropriate format:
    - Use the date-only format (e.g., "11/25/2025") if the timestamp is unnecessary for the context.
    - Retain the full date-time format (e.g., "11/25/2025 3:03:47 PM") if the timestamp is relevant to the column's purpose.
12. Omit values such as "N/A" or "N/A" from the consolidated output unless they are critical to the data's meaning.

SPECIAL RULES FOR DIFFERENT COLUMN TYPES:

A. CONFIDENCE COLUMNS (columns ending with "_Confidence"):
   - Preserve ALL values including duplicates in their original order.
   - Example: [98, 98, 97, 97, 97] → "98;98;97;97;97"

B. FINAL VALUE COLUMNS (columns that accumulate information, take ONLY the last/final row value):
   - Columns like: Total, Summary, Final_Amount, Page_Number, Status, Complete_Text, Description
   - Take ONLY the value from the LAST row (most complete/final information).
   - Example: Row1="partial text", Row2="partial more", Row3="complete final text" → "complete final text"

C. MERGE UNIQUE COLUMNS (all other columns - default behavior):
   - Deduplicate and merge unique values.
   - Example: [value1, value1, value2, value3] → "value1;value2;value3"

COLUMN CLASSIFICATION GUIDE:
- If column name contains: "total", "summary", "final", "complete", "description", "page", "status" → Use FINAL VALUE (Rule B)
- If column name ends with "_Confidence" → Use ALL VALUES (Rule A)
- All other columns → Use MERGE UNIQUE (Rule C)
"""
        return instructions


----------------

class SimpleCSVConsolidator:
    def build_prompt(self, rows: List[Dict]) -> str:
        instructions = """
1. Keep identical values only once (except for special columns).
2. Merge differing values intelligently.
3. Merge line items so each line appears once.
4. Do not lose any information.
5. Do not duplicate information.
6. Use EXACT SAME column names as input.
7. Output must be VALID JSON ONLY.
8. Output must represent ONE consolidated row.
9. Consider numeric sequences before merging values.
10. Use ";" to separate merged values where applicable.
11. Handle date/timestamp appropriately.
12. Omit "N/A" values unless critical.

INTELLIGENT COLUMN CONSOLIDATION STRATEGY:

Rule A - PRESERVE ALL VALUES (for confidence metrics):
- Columns ending with "_Confidence" or "Confidence"
- Keep every value including duplicates
- Format: "98;98;97;97;97"

Rule B - TAKE FINAL VALUE ONLY (for cumulative/progressive data):
- Apply when values progressively build up (each row adds more content)
- Indicators: Text length increases, descriptions become more complete, totals accumulate
- Common patterns: Description, Summary, Total, Status, Page_Text, Complete_Info
- Take ONLY the last row's value
- Format: "final complete value"

Rule C - MERGE UNIQUE VALUES (default for discrete data):
- For discrete values that don't build progressively
- Common patterns: IDs, Names, Categories, Line_Items, Products
- Deduplicate and merge
- Format: "value1;value2;value3"

DECISION LOGIC:
1. Check if column ends with "_Confidence" → Apply Rule A
2. Analyze if values grow/accumulate across rows → Apply Rule B
3. Otherwise → Apply Rule C (default)

Examples:
- "Item_Confidence": [98,98,97,97] → "98;98;97;97" (Rule A)
- "Description": ["Item A", "Item A desc", "Item A complete description"] → "Item A complete description" (Rule B)
- "Product_ID": ["P1", "P1", "P2", "P3"] → "P1;P2;P3" (Rule C)
"""
        return instructions

-----
option 2
class SimpleCSVConsolidator:
    def __init__(self):
        # Define which columns should take only final value
        self.final_value_columns = [
            'Description', 'Total_Amount', 'Page_Number', 
            'Status', 'Summary', 'Complete_Text'
        ]
    
    def build_prompt(self, rows: List[Dict]) -> str:
        final_cols_str = ", ".join(self.final_value_columns)
        
        instructions = f"""
1. Keep identical values only once (except for special columns mentioned below).
2. Merge differing values intelligently.
3. Merge line items so each line appears once.
4. Do not lose any information.
5. Do not duplicate information.
6. Use EXACT SAME column names as input.
7. Output must be VALID JSON ONLY.
8. Output must represent ONE consolidated row.
9. Consider numeric sequences before merging values; ensure numbers are evaluated correctly.
10. Use ";" to separate merged values where applicable, instead of "/" or "-".
11. Handle date/timestamp appropriately based on context.
12. Omit "N/A" values unless critical.

SPECIAL CONSOLIDATION RULES:

A. For columns ending with "_Confidence":
   → Keep ALL values including duplicates
   → Example: [98, 98, 97] → "98;98;97"

B. For these specific columns: {final_cols_str}
   → Take ONLY the LAST/FINAL row's value (most complete information)
   → Example: Row1="part1", Row2="part1 part2", Row3="complete" → "complete"

C. For all other columns:
   → Merge unique values only (deduplicate)
   → Example: [A, A, B, C] → "A;B;C"
"""
        return instructions
