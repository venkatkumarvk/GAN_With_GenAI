import json
from schema_helper import DatabricksSchemaGenerator
from insert_helper import InsertSQLGenerator

def main():
    try:
        # Load config
        with open("schema_config.json", 'r') as f:
            config = json.load(f)

        # Run schema generation
        print("üõ†Ô∏è Generating SCHEMA (CREATE + DROP)...")
        schema_gen = DatabricksSchemaGenerator(
            excel_file_path=config["excel_file_path"],
            output_base_folder=config.get("output_base_folder", "generated_schemas"),
            sheet_name=config.get("sheet_name"),
            categories=config["categories"],
            generate_drop_statements=config.get("generate_drop_statements", False)
        )
        schema_gen.run()

        # Run insert generation
        print("\nüì• Generating INSERT statements...")
        insert_gen = InsertSQLGenerator(
            excel_file_path=config["excel_file_path"],
            output_folder="generated_inserts",
            sheet_name=config.get("sheet_name"),
            categories=config["categories"]
        )
        insert_gen.run()

        print("\n‚úÖ All tasks completed successfully!")

    except FileNotFoundError:
        print("‚ùå Error: schema_config.json not found.")
    except Exception as e:
        print(f"‚ùå Error: {e}")

if __name__ == "__main__":
    main()
