from azure.ai.formrecognizer import DocumentAnalysisClient
from azure.core.credentials import AzureKeyCredential
import os

# Azure Document Intelligence Configuration
endpoint = "your_document_intelligence_endpoint"
key = "your_document_intelligence_key"

# Initialize Document Analysis Client
document_analysis_client = DocumentAnalysisClient(
    endpoint=endpoint, 
    credential=AzureKeyCredential(key)
)

# Directory containing PDF files
input_directory = "path/to/your/pdf/folder"

# Custom Model ID
CUSTOM_MODEL_ID = "DCM"

# Process each PDF in the directory
for filename in os.listdir(input_directory):
    if filename.endswith(".pdf"):
        file_path = os.path.join(input_directory, filename)
        
        try:
            # Open the PDF file
            with open(file_path, "rb") as document:
                # Analyze document using your custom model
                poller = document_analysis_client.begin_analyze_document(
                    model_id=CUSTOM_MODEL_ID, 
                    document=document
                )
                result = poller.result()
                
                # Print basic document information
                print(f"\nDocument: {filename}")
                print(f"Model Used: {result.model_id}")
                
                # Extract key-value pairs
                print("\nKey-Value Pairs:")
                for kv in result.key_value_pairs:
                    print(f"{kv.key.content}: {kv.value.content}")
                
                # Print confidence
                print(f"\nModel Confidence: {result.confidence}")
                
                # Extract pages
                print(f"\nTotal Pages: {len(result.pages)}")
                
                # Print document fields (specific to custom model)
                print("\nDocument Fields:")
                for name, field in result.fields.items():
                    print(f"{name}: {field.value}")
                
                print("-" * 50)
        
        except Exception as e:
            print(f"Error processing {filename}: {str(e)}")
