parser.add_argument("--folder", required=True,
                 help="Folder path in Azure Blob Storage (input)")
parser.add_argument("--outputfolder", required=False, default=None,
                 help="Folder path in Azure Blob Storage (output). If not specified, uses default from config")
parser.add_argument("--doctype", required=True, choices=["invoice", "eob", "claim"],
                 help="Document type")


  ------------

  if args.source == "azure":
    process_azure_pdf_files(
        config, 
        args.apitype, 
        args.folder, 
        args.doctype, 
        logger, 
        enable_overlay, 
        enable_preprocessing, 
        enable_ocr,
        output_folder=args.outputfolder
    )

----------

def process_azure_pdf_files(config, api_type, azure_folder, doc_type, logger, enable_overlay=None, enable_preprocessing=None, enable_ocr=None, output_folder=None):
    """
    Process PDF files from Azure Blob Storage with OCR support.
    
    Parameters:
    - config: Configuration dictionary
    - api_type: 'batch' or 'general'
    - azure_folder: Folder path in Azure Blob Storage (input)
    - doc_type: Document type ('invoice', 'eob', 'claim')
    - logger: Logger instance
    - enable_overlay: Override overlay setting
    - enable_preprocessing: Override preprocessing setting
    - enable_ocr: Override OCR setting
    - output_folder: Custom output folder path (optional)
    """


  -------------

  # Get Azure storage configuration
storage_config = config.get("azure_storage", {})
connection_string = storage_config.get("connection_string")
input_container = storage_config.get("input_container")
output_container = storage_config.get("output_container")

# Handle custom output folder
if output_folder:
    high_confidence_folder = output_folder.rstrip('/') + '/'
    low_confidence_folder = output_folder.rstrip('/') + '/'
    logger.info(f"Using custom output folder: {output_folder}")
else:
    high_confidence_folder = storage_config.get("high_confidence_folder", "high_confidence/")
    low_confidence_folder = storage_config.get("low_confidence_folder", "low_confidence/")
    logger.info(f"Using default output folders: {high_confidence_folder}, {low_confidence_folder}")


  -----------

  # Initialize storage helper with custom folders
storage_helper = AzureStorageHelper(
    connection_string,
    input_container,
    output_container,
    config.get("archive", {}),
    logger,
    high_confidence_folder=high_confidence_folder,
    low_confidence_folder=low_confidence_folder
)

  -------------------

  class AzureStorageHelper:
    def __init__(self, connection_string, input_container, output_container, archive_config, logger, high_confidence_folder=None, low_confidence_folder=None):
        self.connection_string = connection_string
        self.input_container = input_container
        self.output_container = output_container
        self.archive_config = archive_config
        self.logger = logger
        
        # Set output folders (use provided or default from config)
        self.high_confidence_folder = high_confidence_folder if high_confidence_folder else "high_confidence/"
        self.low_confidence_folder = low_confidence_folder if low_confidence_folder else "low_confidence/"
        
        # Get archive container from config
        self.archive_container = archive_config.get("input_archive_container", "archived-documents")
        
        self.logger.info(f"AzureStorageHelper initialized")
        self.logger.info(f"  High confidence folder: {self.high_confidence_folder}")
        self.logger.info(f"  Low confidence folder: {self.low_confidence_folder}")

  ------------------------

  def upload_results(self, csv_content, original_filename, doc_type, confidence_level, logger):
    """Upload results CSV and document to output container"""
    try:
        # Determine output folder based on confidence (use instance variables)
        if confidence_level == "high":
            output_folder = self.high_confidence_folder
        else:
            output_folder = self.low_confidence_folder


  --------------

  # Handle custom output folder
if output_folder:
    # Custom folder with high/low subfolders
    base_folder = output_folder.rstrip('/') + '/'
    high_confidence_folder = base_folder + 'high_confidence/'
    low_confidence_folder = base_folder + 'low_confidence/'
    logger.info(f"Using custom output folder: {output_folder}")
    logger.info(f"  High confidence: {high_confidence_folder}")
    logger.info(f"  Low confidence: {low_confidence_folder}")
else:
    high_confidence_folder = storage_config.get("high_confidence_folder", "high_confidence/")
    low_confidence_folder = storage_config.get("low_confidence_folder", "low_confidence/")
    logger.info(f"Using default output folders")
    logger.info(f"  High confidence: {high_confidence_folder}")
    logger.info(f"  Low confidence: {low_confidence_folder}")


  
