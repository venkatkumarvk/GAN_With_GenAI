import os
import logging
from logging.handlers import RotatingFileHandler

def setup_logging(config):
    """
    Configure logging based on the configuration
    
    :param config: Configuration dictionary
    """
    try:
        # Ensure log directory exists
        log_dir = config['paths'].get('log_dir', 'logs')
        os.makedirs(log_dir, exist_ok=True)

        # Prepare log file path
        log_file = os.path.join(log_dir, config['logging'].get('file', 'document_classification.log'))

        # Configure logging level
        log_level = getattr(logging, config['logging'].get('level', 'INFO').upper())

        # Configure logging format
        log_format = config['logging'].get(
            'format', 
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )

        # Configure root logger
        logging.basicConfig(
            level=log_level,
            format=log_format,
            handlers=[
                # File handler with rotation
                RotatingFileHandler(
                    log_file, 
                    maxBytes=10*1024*1024,  # 10 MB
                    backupCount=5
                ),
                # Console handler
                logging.StreamHandler()
            ]
        )

        # Additional configuration for specific loggers if needed
        # Example: Set specific logger levels
        logging.getLogger('azure').setLevel(logging.WARNING)
        logging.getLogger('openai').setLevel(logging.WARNING)

        logging.info("Logging configuration initialized successfully")
    
    except Exception as e:
        # Fallback logging configuration
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            handlers=[
                logging.StreamHandler()
            ]
        )
        logging.error(f"Failed to set up logging configuration: {e}")

def get_logger(name):
    """
    Get a logger with the specified name
    
    :param name: Name of the logger
    :return: Configured logger
    """
    return logging.getLogger(name)


-------

import json
import logging
from azure_keyvault import load_config_with_keyvault
from logging_config import setup_logging

def load_config(config_path):
    """
    Load configuration file with Azure Key Vault support
    
    :param config_path: Path to the configuration file
    :return: Processed configuration dictionary
    """
    try:
        # Use the new Key Vault-aware configuration loader
        config = load_config_with_keyvault(config_path)
        
        # Setup logging based on the loaded configuration
        setup_logging(config)
        
        return config
    except Exception as e:
        # Fallback logging
        logging.basicConfig(level=logging.INFO)
        logging.error(f"Failed to load configuration: {e}")
        raise

