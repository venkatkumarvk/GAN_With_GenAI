import os
import logging
import logging.handlers
from datetime import datetime

def setup_logging(config):
    """
    Set up logging configuration based on the config
    
    :param config: Configuration dictionary
    """
    # Ensure log directory exists
    log_dir = config.get('paths', {}).get('log_dir', 'logs')
    os.makedirs(log_dir, exist_ok=True)

    # Create log filename with timestamp
    timestamp = datetime.now().strftime("%Y%m%d")
    log_filename = os.path.join(log_dir, f"document_classification_{timestamp}.log")

    # Logging configuration
    log_level = config.get('logging', {}).get('level', 'INFO')
    log_format = config.get('logging', {}).get('format', 
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s')

    # Convert log level string to logging constant
    log_level_map = {
        'DEBUG': logging.DEBUG,
        'INFO': logging.INFO,
        'WARNING': logging.WARNING,
        'ERROR': logging.ERROR,
        'CRITICAL': logging.CRITICAL
    }
    numeric_level = log_level_map.get(log_level.upper(), logging.INFO)

    # Configure root logger
    logging.basicConfig(
        level=numeric_level,
        format=log_format,
        handlers=[
            # File handler
            logging.FileHandler(log_filename, encoding='utf-8'),
            # Console handler
            logging.StreamHandler()
        ]
    )

    # Rotate log files
    file_handler = logging.handlers.RotatingFileHandler(
        log_filename, 
        maxBytes=10*1024*1024,  # 10 MB
        backupCount=5,
        encoding='utf-8'
    )
    file_handler.setFormatter(logging.Formatter(log_format))

    # Add rotate handler to root logger
    logging.getLogger().addHandler(file_handler)

    # Optionally, set logging for specific libraries
    logging.getLogger('azure').setLevel(logging.WARNING)
    logging.getLogger('openai').setLevel(logging.WARNING)

    return logging.getLogger(__name__)

def get_logger(name=None):
    """
    Get a logger with optional name
    
    :param name: Name of the logger
    :return: Configured logger
    """
    return logging.getLogger(name or __name__)



-----
{
    "paths": {
        "log_dir": "/path/to/logs"
    },
    "logging": {
        "level": "INFO",
        "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    }
}

----


import json
import logging
from azure_keyvault import load_config_with_keyvault
from logging_config import setup_logging

def load_config(config_path):
    """
    Load configuration file with Azure Key Vault support
    
    :param config_path: Path to the configuration file
    :return: Processed configuration dictionary
    """
    try:
        # Load configuration with Key Vault resolution
        config = load_config_with_keyvault(config_path)
        
        # Setup logging based on config
        setup_logging(config)
        
        return config
    except Exception as e:
        # Fallback logging if main logging setup fails
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        logger = logging.getLogger(__name__)
        logger.error(f"Failed to load configuration: {e}")
        raise
