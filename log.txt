import os
import logging
import logging.handlers
from datetime import datetime
from pathlib import Path

class LoggerHelper:
    def __init__(self, name="document_processor", log_dir="logs", log_level=logging.INFO):
        """
        Initialize logger with comprehensive logging capabilities
        
        :param name: Name of the logger
        :param log_dir: Directory to store log files
        :param log_level: Logging level
        """
        # Create logs directory if it doesn't exist
        self.log_dir = Path(log_dir)
        self.log_dir.mkdir(parents=True, exist_ok=True)
        
        # Create timestamp
        self.timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        
        # Configure root logger to capture logs from all modules
        logging.basicConfig(
            level=log_level,
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S',
            handlers=[]  # We'll add handlers manually
        )
        
        # Create logger
        self.logger = logging.getLogger(name)
        self.logger.setLevel(log_level)
        
        # Clear any existing handlers
        for handler in self.logger.handlers[:]:
            self.logger.removeHandler(handler)

    def setup_logging(self, config):
        """
        Setup comprehensive logging for the entire application
        
        :param config: Configuration dictionary
        """
        # Create log filename
        log_filename = f"document_processing_{self.timestamp}.log"
        log_path = self.log_dir / log_filename

        # Create file handler
        file_handler = logging.FileHandler(log_path)
        file_handler.setLevel(logging.INFO)
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S'
        )
        file_handler.setFormatter(formatter)

        # Create console handler
        console_handler = logging.StreamHandler()
        console_handler.setLevel(logging.INFO)
        console_handler.setFormatter(formatter)

        # Add handlers to root logger to capture logs from all modules
        root_logger = logging.getLogger()
        root_logger.addHandler(file_handler)
        root_logger.addHandler(console_handler)

        # Log configuration details
        self.log_section_header("Starting Document Processing")
        
        # Log key configuration details
        try:
            # Azure OpenAI configuration
            self.logger.info("Azure OpenAI Configuration:")
            openai_config = config.get('azure_openai', {})
            self.logger.info(f"  Endpoint: {openai_config.get('endpoint', 'Not configured')}")
            self.logger.info(f"  Deployment: {openai_config.get('deployment_name', 'Not configured')}")
            self.logger.info(f"  API Version: {openai_config.get('api_version', 'Not configured')}")
            
            # Classification configuration
            classification_config = config.get('classification', {})
            self.logger.info("Classification Configuration:")
            self.logger.info(f"  Confidence Threshold: {classification_config.get('confidence_threshold', 'Not set')}")
            self.logger.info(f"  Batch Size: {classification_config.get('batch_size', 'Not set')}")
            
            # Storage configuration
            storage_config = config.get('azure_storage', {})
            self.logger.info("Storage Configuration:")
            self.logger.info(f"  Input Container: {storage_config.get('input_container', 'Not set')}")
            self.logger.info(f"  Output Container: {storage_config.get('output_container', 'Not set')}")
        except Exception as e:
            self.logger.error(f"Error logging configuration details: {e}")
        
        self.log_section_header("Processing Started")

    def log_section_header(self, title):
        """
        Log a section header for better readability
        
        :param title: Section title
        """
        separator = "=" * 50
        self.logger.info(separator)
        self.logger.info(title.center(50))
        self.logger.info(separator)

def setup_logger(config, log_level=logging.INFO):
    """
    Set up and configure a logger with comprehensive logging
    
    :param config: Configuration dictionary
    :param log_level: Logging level
    :return: Configured logger
    """
    # Initialize logger helper
    helper = LoggerHelper(
        name="document_processor",
        log_dir=config.get('paths', {}).get('log_dir', 'logs'),
        log_level=log_level
    )
    
    # Setup logging
    helper.setup_logging(config)
    
    return helper.logger



-----

from logger_helper import setup_logger


----
def main():
    # Parse arguments
    args = parse_arguments()
    
    try:
        # Load configuration
        config = load_config(args.config)
        
        # Setup logging
        logger = setup_logger(config)
        
        # Rest of the main function remains the same
        ...
from logger_helper import setup_logger
